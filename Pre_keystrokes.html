<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>aSCRIBEa&#8482;</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="./favicon.ico" />
    <!-- <script src="./data/default_data.js"></script>****************LOAD-CUSTOM-DATA-MODULE****************** -->
    <script  > //****************IMPORT _default_ DATA-MODULE******************
        // let _default_TICKR_DATA_MAP_Monthly = default_TICKR_DATA_MAP_Monthly
        // let _default_TRADE_DATA_MAP_Monthly = default_TRADE_DATA_MAP_Monthly
        // let _default_MOMZ_DATA_MAP = default_MOMZ_DATA_MAP
    </script>  <!-- **************************END-CUSTOM-DATA-MODULE******************-->
    <style>

body {
    background-color: black;
    color: steelblue;
    display: flex;
    justify-content: flex-start;
    align-items: center;
    flex-direction: column;
    /* height: 100%; */
    height: 100vh;
    /* padding-top: 1em; */
    /* padding-bottom: 1em; */
    font-family: Arial, sans-serif;
    overflow: hidden;
    min-height: 100vh;
    margin:0;
}

#renderTokenFrame {
    width: 98%;
    height: 444px;
    border: 1px solid steelblue;
    overflow-y: auto;
    padding: 10px;
    background: black;
    scroll-behavior: smooth;
    border-radius: 18px;
    margin-right: 2em;
    display: flex; 
    flex-direction: column;
}

.token-row {
    margin-bottom: 10px;
    padding: 8px;
    border-radius: 4px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    border: 1px solid #310131;
    border-radius: 22px
}

.token-row:hover {
    transform: translateX(5px);
    box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
}

.row-number {
    color: steelblue;
    font-size: 0.8em;
    margin-right: 8px;
    min-width: 30px;
}

.row-content {
    flex-grow: 1;
    padding: 4px;
    padding-left: 1em;
    padding-right: 1em;
    border-radius: 25px;
    border: 1px solid steelblue;
}

.token-text {
    margin-left: 12px;
}
.controls {
    /* padding: 10px; */
    /* background: #eee; */
    /* border: 1px solid #ddd; */
    /* margin-top: 10px; */
    /* display: flex; */
    /* gap: 20px; */
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-top: 8px;
    padding-bottom:10px;
    background:black;
    border:1px solid steelblue;
    border-radius: 13px;
}
.controlBar {
    padding: 10px;
    background: black;
    border: solid 1px lime;
    border-radius: 17px;
    margin: 0.444em 4% 0 4%;
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    align-items: center;
}

/* .control-group {
    display: flex;
    align-items: center;
    gap: 8px;
} */

.commonTXTAREA:focus-visible {
    outline: none;
    border: 1px solid dodgerblue;
}
.commonTXTAREA {
    width: 100%;
    background: #111;
    color: lime;
    border: 1px solid aqua;
    border-radius: 13px;
    padding: 1em;
    font-size: 16px;
    resize: vertical;
    box-sizing: border-box;
    line-height: 1.5;
    margin:0.222em 0 0.222em 0;
}
select {
    padding: 4px;
    border-radius: 4px;
}

.checkbox-wrapper {
    display: flex;
    align-items: center;
    gap: 4px;
    margin-right: 8px;
}

#autoScrollBtn {
    padding: 8px 16px;
    background: #073008;
    color: white;
    border: none;
    border-radius: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
}

#autoScrollBtn:hover {
    background: #45a049;
}

#autoScrollBtn.active {
    background: #f44336;
}

/**********************Inline Edit Style**********************/
.edit-input{
    color:aqua !important;
    margin-bottom:0.222em !important;
    font-size: 14px !important;
    width: 100% !important;
    line-height: 1em !important;
}

.save-btn .cancel-btn{
    font-size:16px !important;
}
/**********************END Inline Edit Style**********************/

/* CUSTOM CHECKBOX *************************************************/
.checkboxFrame {
    display:flex;position:relative;padding: 0em 0em 0.666em 0em;margin: 0em 1em 0em 1em;
    cursor: pointer;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
.checkboxFrame input {/* Hide the browser's default checkbox */
    position: absolute;opacity: 0;cursor: pointer;height: 0;width: 0;
}      
.checkmark {
    border:1px solid lime;border-radius:3px;position: absolute;
    top: 0;left: 0;height: 10px;width: 10px;
    background-color: black; box-shadow: 0px 2px 6px 1px #010191;  
}
.checkboxFrame:hover input ~ .checkmark { background-color: #014601;}
.checkboxFrame input:checked ~ .checkmark {  background-color: steelblue;}
.checkmark:after {content: "";position: absolute;display: none;}
.checkboxFrame input:checked ~ .checkmark:after { display: block;}
.checkboxFrame .checkmark:after {left: 4px;top: -1px;width: 2px;height: 6px;
    border: solid #014601;border-width: 0 3px 3px 0;
    -webkit-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    transform: rotate(45deg);
}

.aNUMBOX1{
    display: flex;
    align-items: center;
    font-size: 0.666em;
    margin-right: 1em;
}
/**END CUSTOM CHECKBOX******************************************************/
/* ***********************************CUSTOM SCROLLBAR****************************/
.scrollBarV {overflow-x:scroll;}
.scrollBarV::-webkit-scrollbar-track { background-color: #010213;  border-radius: 13px; }
.scrollBarV::-webkit-scrollbar { width: 0.666em; height: 100%; }
.scrollBarV::-webkit-scrollbar-thumb { background-color: #04223c; border-radius: 13px;
    background-image: -webkit-linear-gradient(0deg, rgba(255, 255, 255, 0.6) 26%, transparent 26%, transparent 51%, rgba(255, 255, 255, -0.4) 51%, rgba(255, 255, 255, 0.6) 74%, transparent 74%, transparent);
}             

.app-frame {
    width: 90%; /* MOBILE overriden */
    border: 2px solid aqua;
    border-radius: 13px;
    padding: 20px;
    position: relative;
    width: 90%;
    height: calc(100vh - 166px); /* Adjust 166px based on nav height + margins */
    max-height: calc(100vh - 166px);
    border: 2px solid aqua;
    border-radius: 13px;
    padding: 20px;
    position: relative;
    overflow-y: auto;
    margin-bottom: 20px;
}

#text-display {
    width: 100%;
    height: 60vh;
    background-color: #111;
    color: steelblue;
    border: 1px solid aqua;
    border-radius: 13px;
    padding: 1em 2% 1em 2%;
    font-size: 16px;
    resize: vertical;
    box-sizing: border-box;
    line-height: 1.5;
}


.control-row {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    flex-wrap: wrap;
}

button {
    background-color: #222;
    color: steelblue;
    border: 1px solid aqua;
    border-radius: 13px;
    padding: 8px 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 100px;
}

button:hover {
    background-color: #333;
    color: aqua;
}

button:active {
    background-color: #111;
}

.control-group {
    display: flex;
    align-items: baseline;
    gap: 8px;
    font-size:0.888em;
}

select, input[type="text"] {
    background-color: #222;
    color: steelblue;
    border: 1px solid aqua;
    border-radius: 13px;
    padding: 8px;
    padding-left:1em;
    cursor: pointer;
    outline: none;
    width: 100%;
}

select{font-size: 1em;}
button{font-size: 0.888em;}

select:hover, input[type="text"]:hover {
    background-color: #333;
}

option {
    background-color: #111;
}

.label {
    color: steelblue;
    font-size: 16px;
    min-width: 50px;
    text-align: center;
}

.title-display {
    font-size: 18px;
    font-weight: bold;
    min-width: 150px;
    text-align: center;
}

.keyboard-hint {
    text-align: center;
    color: #666;
    font-size: 14px;
    margin-top: 10px;
    font-style: italic;
}

nav {
    position: sticky;
    bottom: 0;
    background: black;
    z-index: 100;
    padding: 10px 0;
}

    /* ************* CUSTOM MOBILE ***********************/
    @media only screen and (max-width: 600px) { /************* PHONE */
        .mainBtn{ font-size:0.666em; min-width:0; }
        #NAV_MENU{        justify-content: space-evenly;
            width: 80%;}
        .control-group{font-size: 0.666em;}
        select{font-size: 0.999em;}
        button{font-size: 0.666em;}
        .editBtn{font-size: 0.888em;
            min-width: 8em;}
    }
    @media only screen and (min-width: 600px) { /************* PC */
        .pcStyle{width:66%; padding:1em 3em 0 3em;}
    }

.middle-size {
    height: 300px !important;
}

.maximized {
    height: calc(100vh - 295px) !important;
}

.hidden {
    display: none !important;
}

#countdownFrame{
    position: fixed; 
    width:80%;
    height: 88%;
    z-index: 10;
    display:none;
    background: rgba(0, 0, 0, 0.8);
    padding: 5px 15px;
    border-radius: 13px;
    border: 1px solid aqua;
    align-items: center;
    justify-content: center;
    margin-top: 10%;
}    
#countdown {
    transform: translateX(-50%);
    transform: translateY(40%);
    display:flex;
    background: rgba(0, 0, 0, 0.8);
    color: lime;
    padding: 4%;
    font-family: monospace;
    font-size: 4.444em;        
    border-radius: 13px;
    border: 1px solid aqua;
}

.countUpTimer-display {

    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: lime;
    padding: 5px 15px;
    border-radius: 13px;
    border: 1px solid aqua;
    font-family: monospace;
    font-size: 1.2em;
    display: block;
    margin-left: 2em;
}

.topLINE {
    position: fixed;
    left: 0;
    top: 40%;
    transform: translateY(-40%);
    width: 100%;
    height: 1px;
    background-color: teal;
    box-shadow: 0 0 8px 3px rgba(0, 128, 128, 0.5);
    display: none;
    z-index: 1001;
}
/* .midLINE {
    position: fixed;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 100%;
    height: 1px;
    background-color: hsla(60, 100%, 50%, 0.25);
    box-shadow: 0 0 4px yellow;
    display: none;
    z-index: 1001;
} */
.btmLINE {
    position: fixed;
    left: 0;
    top: 60%;
    transform: translateY(-60%);
    width: 100%;
    height: 1px;
    background-color: hsla(300, 100%, 50%, 0.5);
    box-shadow: 0 0 9px 3px purple;
    display: none;
    z-index: 1001;
}
</style>
</head>
<body>
    <section id="MSGBOX" class="mainBtn" style="border-radius:20px;
        background:#091d3e;padding:4px 4px 8px 4px;display:none;
        border: 1px solid rgb(221, 118, 2);color:rgb(221, 118, 2);
        position: absolute;top: 0.666em;z-index: 10;
        ">⚠️ error...</section>
<script>//----CUSTOM-UTILITY-----------------
        //----------------------------------DATE-TIME------------
        const currentDate = new Date();
        const year = currentDate.getFullYear();
        const month = (currentDate.getMonth() + 1).toString().padStart(2, '0'); // Adding 1 because months are zero-indexed
        const day = currentDate.getDate().toString().padStart(2, '0');
        let current_ymd = `${year}_${month}_${day}`;
        let current_sig = `~:)`;

    //----------------------------USR MSG -------------
    let showUSRMSG = (msg) => {
        let MSGBOX = document.getElementById('MSGBOX');
        MSGBOX.innerHTML = msg;
        MSGBOX.style.display = "inline";
        setTimeout( ()=>{ MSGBOX.style.display = "none"; },2000);
    }//----------------------------end USR MSG -------------    
</script>
<script>/************LOCAL_STORAGE****************/
    /************************************************\
     * - ai_aSCRIBEa_DATA_MATRIX
     *  - ability to save DATA in localstorage
    \************************************************/
    let ai_aSCRIBEa_DATA=null;
    const ai_aSCRIBEa_DATA_LOAD_MOCK_DATA=()=>{ //READ
        ai_aSCRIBEa_DATA = {"TXTZ":[
            {"id":"GUI1","main_title":"txt1", "sub_title":"subtitle1", "txt":"text 1\n\n[something]...", "version":"v", "description":"description 1"},
            {"id":"GUI2","main_title":"txt2", "sub_title":"subtitle2", "txt":"text 2", "version":"v2", "description":"description 2"},
            {"id":"GUI3","main_title":"txt3", "sub_title":"subtitle3", "txt":"text 3", "version":"v3", "description":"description 3"}
        ]};
    };
    const ai_aSCRIBEa_DATA_init=()=>{ //READ from LOCAL STORAGE
        ai_aSCRIBEa_DATA = (localStorage.ai_aSCRIBEa_DATA)?
            JSON.parse( localStorage.ai_aSCRIBEa_DATA ):null;
        // ai_aSCRIBEa_DATA = null; //DEV: load mock data for testing
        if(!ai_aSCRIBEa_DATA){
            ai_aSCRIBEa_DATA_LOAD_MOCK_DATA();
        }
    }; ai_aSCRIBEa_DATA_init(); 
    //****************************END ai_aSCRIBEa_DATA_matrix
    const SAVE_DOCZ = ()=>{ //SAVE
        localStorage.ai_aSCRIBEa_DATA = JSON.stringify(ai_aSCRIBEa_DATA);
        showUSRMSG('📀 SAVED 📀');
    };
    /************END_LOCAL_STORAGE****************/
</script>
    
<h1 style="margin: 0px; display: flex; width: 100%; justify-content: center; 
font-size: 0.888em; color: steelblue;margin: 8px 0 8px 0;">aSCRIBEa</h1>

<aside id="countdownFrame">
    <div id="countdown"></div>
</aside>

<article id="NAV_INFO" class="app-frame pcStyle scrollBarV" style="display:none;">
    <h2 style="align-self: flex-start; color: steelblue; 
    font-size: 1em;">ABOUT</h2>
    <div style="border: 1px solid aqua; border-radius: 10px; padding: 10px; display: flex; 
    flex-direction: column; gap: 10px;padding: 4%;">
        <div class="control-group">
            <h2>Overview:</h2>
            <section>This app is an AI Rich Text Editor - for SONG LYRICS!
                But it can be used for so much more! Enjoy. ~ : )
            </section>
        </div>
        <div class="control-group" style="    display: flex; gap: 8px; font-size: 0.888em; flex-direction: column;
            align-items: flex-start;    padding: 2% 0 2% 4%;">
            <span style="    display: flex
            ;
                align-items: center;"><h2 style="margin-right:0.555em;">Project:</h2>             aSCRIBEa, is a pipeline to build HITPOPSONGZ, as MUSIC, VIDEO, VOICE, and TEXT, stories.
            </span>
            
            <div style="border: 1px solid aqua; border-radius: 10px; padding: 10px; background: #111; color: steelblue;">
                <h3 style="color: aqua; margin-bottom: 10px;">GOALS:</h3>
                <ul style="list-style-type: none; padding-left: 0;">
                    <li>- AI GENERATED SONG LYRICS.</li>
                    <li>- AI GENERATED POEMS.</li>
                    <li>- AI GENERATED STORIES.</li>
                    <li>- AI GENERATED MUSIC.</li>
                    <li>- AI GENERATED VIDEO.</li>
                    <li>- AI GENERATED ART.</li>
                </ul>
            </div>

        </div>
        <div class="control-group">
            <h2>Good Cause:</h2>
            <section>
                <p>It is designed to help you write songs, poems, stories, and more.</p>
                <ul>
                    <li>Enables creativity and expression for artists, writers, and creators.</li>
                    <li>Champions an AI process of art generation, as a new art.</li>
                    <li>Produces moral stories for the good of humanity.</li>
                    <li>Multi-modal AI content pipeline for everyone!</li>
                </ul>
            </section>
        </div>
        <div class="control-group">
            <h2 for="">Community:</h2>
            Join HIT_POP_SONG_FACTORY today!
        </div>

    </div>
</article><!--END INFO VIEW-->
<article id="NAV_EDIT" class="app-frame pcStyle scrollBarV" style="display:none;
    gap: 10px; flex-direction: column;">
    <h2 style="align-self: flex-start; color: steelblue;
    font-size: 1em;">EDIT</h2>
    <section style="border: 1px solid aqua; border-radius: 10px; 
    display: flex; flex-direction: column; gap:4px;
    padding: 1em 5%">
    <div class="control-row" style="justify-content: space-between;">
        <button onclick="EDIT_prevTXT()" style="font-size:1.222em;font-weight:bold;line-height: 0.666em;min-width: 4em;text-shadow: -1px 1px 1px blue;"><</button>
        <span id="currentIndexDisplay" style="font-size: 1.222em; color: steelblue;">0</span>
        <!-- <script>  function updateCurrentIndexDisplay() {
                document.getElementById('currentIndexDisplay').textContent = TXT_IDX?(TXT_IDX + 1):1;
            }; updateCurrentIndexDisplay();
        </script> -->
        <button onclick="EDIT_nextTXT()" style="font-size:1.222em;font-weight:bold;line-height: 0.666em;min-width: 4em;text-shadow: -1px 1px 1px blue;">></button>
    </div>
    <div class="control-row" style="justify-content: space-between;    margin-top: 1em;">
        <label for="EDIT_TXT_TITLE_MAIN">MAIN-TITLE:</label>
        <input id="EDIT_TXT_TITLE_MAIN" type="text" placeholder="Enter song title..."
        style="color:burlywood;    min-width: 80%;
    flex: 1 1 0;">
    </div>
    <div class="control-group">
        <label style="min-width: 6em;" for="EDIT_TXT_SUB_TITLE">SUB-TITLE:</label>
        <input type="text" id="EDIT_TXT_SUB_TITLE" placeholder="Sub Title..." 
            style="color:burlywood; margin-top: 1em;">
        </input>
    </div>
    <div class="control-group">
        <label style="min-width: 6em;" for="EDIT_TXT_VERSION">VERSION:</label>
        <input id="EDIT_TXT_VERSION" type="text" id="version" placeholder="Number"
        style="color:aqua; width:22%;height: 0.333em;
    margin: 1em 0;">
    </div>    
    <div class="control-group" style="display: flex; flex-direction: column;">
        <label for="EDIT_TXT_TXT">TXT:</label>
        <textarea id="EDIT_TXT_TXT" class="commonTXTAREA  scrollBarV" 
        placeholder="Enter content text..." rows="4"
        style="height:222px;"></textarea>
    </div>

    <div class="control-group" style="display: flex; flex-direction: column;
        margin-top:0.222em;">
        <label for="EDIT_TXT_DESCRIPTION">DESCRIPTION:</label>
        <textarea id="EDIT_TXT_DESCRIPTION" class="commonTXTAREA  scrollBarV" 
        placeholder="Extra information..." rows="4"
        style="color:plum;height: 88px;"></textarea>
    </div>

    </section>
    <div class="control-row">
        <div class="controlBar" style="border:1px solid steelblue; border-radius:13px;">
            <div class="control-group">
                <button class="editBtn" onclick="newTXT()">New</button>
                <button class="editBtn" onclick="saveTXT_EDIT()">Save</button>
                <button class="editBtn" onclick="deleteTXT()">Delete</button>
                <button class="editBtn" onclick="saveTXT_EDIT(); showPLAYBACK();">Render</button>
            </div>
    <script>
        let TXT_IDX = 0; //index of current document

        function newTXT() {
            document.getElementById('EDIT_TXT_TITLE_MAIN').value = '';
            document.getElementById('EDIT_TXT_SUB_TITLE').value = '';
            document.getElementById('EDIT_TXT_TXT').value = '';
            document.getElementById('EDIT_TXT_VERSION').value = '';
            document.getElementById('EDIT_TXT_DESCRIPTION').value = '';
        }

        function EDIT_prevTXT() {
            if (TXT_IDX > 0) {
                TXT_IDX--;
            }else{ //loop to end
                TXT_IDX = ai_aSCRIBEa_DATA["TXTZ"].length - 1;
            } 
            init_EDIT_VIEW();
            updateCurrentIndexDisplay();
        }

        function EDIT_nextTXT() {
            if (TXT_IDX < ai_aSCRIBEa_DATA["TXTZ"].length - 1) {
                TXT_IDX++;
            }else{ //loop to end
                TXT_IDX = 0;
            }
            init_EDIT_VIEW();
            updateCurrentIndexDisplay();
        }

        function saveTXT_EDIT() {
            const main_title = document.getElementById('EDIT_TXT_TITLE_MAIN').value;
            const sub_title = document.getElementById('EDIT_TXT_SUB_TITLE').value || '';
            const txt = document.getElementById('EDIT_TXT_TXT').value;
            const version = document.getElementById('EDIT_TXT_VERSION').value || '';
            const description = document.getElementById('EDIT_TXT_DESCRIPTION').value || '';

            let txtDOC = getTXT_DOC(main_title);
            let doc_id = main_title.trim()+' | '+sub_title.trim()+' | '+version.trim()+' | '+current_ymd ;
            if (txtDOC) { //overwrite : MUST ADD NEW DATA ATTRIBUTES HERE or they will be lost
                txtDOC = { id:doc_id ,main_title: main_title, sub_title: sub_title, txt: txt,
                    version: version, description:description,speed:txtDOC.speed||'100' 
                };
                ai_aSCRIBEa_DATA["TXTZ"][TXT_IDX] = txtDOC;
            } else { //new
                ai_aSCRIBEa_DATA["TXTZ"].push({
                    main_title: main_title, sub_title: sub_title, txt: txt,
                    version: version, description:description,speed:txtDOC.speed||'100'
                });
                TXT_IDX = ai_aSCRIBEa_DATA["TXTZ"].length - 1;
            }
            SAVE_DOCZ(); //save to local storage
            updateCurrentIndexDisplay();
        }

        function deleteTXT() {
            const main_title = document.getElementById('EDIT_TXT_TITLE_MAIN').value;
            const index = ai_aSCRIBEa_DATA["TXTZ"].findIndex(doc => doc.main_title === main_title);
            if (index !== -1) {
                ai_aSCRIBEa_DATA["TXTZ"].splice(index, 1);
                newTXT();
                TXT_IDX = 0;
            }
            SAVE_DOCZ();
            updateCurrentIndexDisplay();
            init_EDIT_VIEW();
        }

        function updateCurrentIndexDisplay() {
            document.getElementById('currentIndexDisplay').textContent = TXT_IDX?(TXT_IDX + 1):1;
        }; updateCurrentIndexDisplay();

        function init_EDIT_VIEW() {
            if(!ai_aSCRIBEa_DATA || !ai_aSCRIBEa_DATA["TXTZ"] || !ai_aSCRIBEa_DATA["TXTZ"].length) {return;}
            const doc = ai_aSCRIBEa_DATA["TXTZ"][TXT_IDX];
            document.getElementById('EDIT_TXT_TITLE_MAIN').value = doc.main_title;
            document.getElementById('EDIT_TXT_SUB_TITLE').value = doc.sub_title || ''
            document.getElementById('EDIT_TXT_TXT').value = doc.txt;
            document.getElementById('EDIT_TXT_VERSION').value = doc.version;
            document.getElementById('EDIT_TXT_DESCRIPTION').value = doc.description;
        }; init_EDIT_VIEW(); updateCurrentIndexDisplay();
    </script>
        </div>
        <div class="controlBar backupBar" style="border:1px solid steelblue; border-radius:13px; margin-top: 1em;">
            <div class="controls-group">
                <input type="file" 
                    id="mdFileInput" 
                    accept=".md" 
                    style="display: none;" 
                    onchange="handleFileUpload(event)">
                <button onclick="document.getElementById('mdFileInput').click()" 
                        class="editBtn">UpLoad MD</button>
                <button onclick="loadMarkdownById()" 
                        class="editBtn">Load MD</button>
                <button onclick="saveMarkdown()" 
                        class="editBtn">DownLoad MD</button>
            </div>
        </div>
        <script>
            async function handleFileUpload(event) {
                const file = event.target.files[0];
                if (file) {
                    try {
                        const text = await file.text();
                        document.getElementById('EDIT_TXT_TXT').value = text;
                        showUSRMSG('File uploaded successfully');
                    } catch (error) {
                        console.error('Error reading file:', error);
                        showUSRMSG('Failed to read file');
                    }
                }
            }

            async function loadMarkdownById() {
                try {
                    const id = ai_aSCRIBEa_DATA['TXTZ'][TXT_IDX].id;
                    const response = await fetch(`./SONGS/${id}.md`);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const text = await response.text();
                    document.getElementById('EDIT_TXT_TXT').value = text;
                    showUSRMSG('File loaded successfully');
                } catch (error) {
                    console.error('Error loading file:', error);
                    showUSRMSG('Failed to load file');
                }
            }
        </script>
    </div>
</article><!--END EDIT VIEW-->

<article id="NAV_PLAYBACK" class="app-frame pcStyle scrollBarV" style="display:none;">

    <div class="control-group" style="width: 110%; margin-left: -1em; max-width:50em;">
        <label>ID:</label>
        <input type="text" id="PLAYBACK_TXT_TITLE" placeholder="Title..." 
            style="color:burlywood; margin-bottom: 1em;">
        </input>
        <button onclick="PLAY_prevTXT()" style="font-size:1.222em;font-weight:bold;line-height: 0.666em;min-width:3em;text-shadow: -1px 1px 1px blue;">◀</button>
        <button onclick="PLAY_nextTXT()" style="font-size:1.222em;font-weight:bold;line-height: 0.666em;min-width:3em;text-shadow: -1px 1px 1px blue;">▶</button>
        <!-- <button onclick="PLAY_prevTXT()" style="font-size:1.222em;font-weight:bold;line-height: 0.666em;min-width: 4em;text-shadow: -1px 1px 1px blue;">◀️</button>
        <button onclick="PLAY_nextTXT()" style="font-size:1.222em;font-weight:bold;line-height: 0.666em;min-width: 4em;text-shadow: -1px 1px 1px blue;">▶️</button> -->
        <button id="toggleSize" onclick="toggleFrameSize()" 
        style="min-width: 3em; margin-right: 3em; display: flex;justify-content: center; background: #073008; color: lime; min-width:2em; 
        border: 1px solid lime; border-radius: 22px; cursor: pointer; padding: 5px 10px;">
            <span class="maximize">▲</span>
        </button>
    </div>

    <section id="renderTokenFrame" class="scrollBarV"></section>



    <div class="control-row">
        <div class="controlBar">
            <div class="control-group">
                <label>Speed:</label>
                <select id="scrollSpeed">
                    <option value="25">Fastest</option>
                    <option value="50">Faster</option>
                    <option value="80">Fast</option>
                    <option value="100" selected>Normal</option>
                    <option value="120">Slow</option>
                    <option value="150">Slower</option>
                    <option value="200">Slowest</option>
                </select>
            </div>
            <button id="autoScrollBtn">Auto Scroll</button>
            <div id="countUpTimer" class="countUpTimer-display">00:00</div>
        </div>            
    </div>


    <div id="RENDER_CONTROLS" class="controls">



        <div id="PAGE_EDIT_CONTROL_ROW" class="control-row">
            <div class="controlBar" style="border:1px solid steelblue; border-radius:13px;">

                <div class="controls-group" style="    margin-top: 2%;">
                    <label class="checkboxFrame">
                        <input id="selectAll" onchange="toggleAll(this)"type="checkbox" class="">
                        <span class="checkmark"></span>
                        <label for="selectAll" style="margin-left: 1em;
                        margin-top: -2px;">All</label>
                    </label>
                </div>

                <div class="control-group">
                    <label>Size:</label>
                    <select id="fontSizeCOMBO">
                        <option value="1">Small</option>
                        <option value="2">Medium</option>
                        <option value="3">Large</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Height:</label>
                    <select id="lineHeightCOMBO">
                        <option value="1">Single</option>
                        <option value="2">Double</option>
                        <option value="3">Triple</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Color:</label>
                    <select id="colorCOMBO">
                        <option value="aqua">Aqua</option>
                        <option value="lime">Lime</option>
                        <option value="purple">Purple</option>
                        <option value="steelblue">Steel Blue</option>
                        <option value="dodgerblue">Blue</option>
                        <option value="turquoise">Turquoise</option>
                        <option value="cyan">Cyan</option>
                    </select>
                </div>
            </div>            
        </div>

    <div id="KEYBOARD_HINT_ROW" class="control-row">
        <div class="keyboard-hint">Press SPACEBAR to toggle auto-scroll</div>
    </div>
</article> <!--END PLAYBACK VIEW-->
<script>
    let TOKEN_DATASET = [
        {row: 1, txt: ["test [text] 1"], color: '', size: 2, height: 2},
        {row: 2, txt: ["test (text) 2"], color: 'lime', size: 2, height: 2},
        {row: 3, txt: ["test act_of_words 3"],  size: 2, height: 3},
        {row: 4, txt: ["test aWORDZa 4"],  size: 1, height: 1}
    ];

    let scrollAnimationFrame = null;
    let lastTimestamp = null;
    let scrollTopFloat = 0.0;
    let checkboxStates = [];
    let isSelectAllChecked = false;
    let isUserScrolling = false;
    let startTime = null;
    let countUpTimerDisplay = null;

    // Add scroll event listener
    document.getElementById('renderTokenFrame').addEventListener('scroll', function(e) {
        if (!scrollAnimationFrame) {
            scrollTopFloat = this.scrollTop;
        }
    });

    function smoothScroll(timestamp) {
        updatecountUpTimer(timestamp);
        const frame = document.getElementById('renderTokenFrame');
        const speed = parseInt(document.getElementById('scrollSpeed').value);
        
        if (!lastTimestamp) lastTimestamp = timestamp;
        const elapsed = timestamp - lastTimestamp;
        // console.log(speed,elapsed);
        // Calculate scroll amount based on speed, Lower speed value = faster scrolling
        const scrollAmount = (elapsed / speed) * 2;

        scrollTopFloat += scrollAmount;
        frame.scrollTop = scrollTopFloat; //cuts to int
        
        // Reset when reaching bottom
        if (frame.scrollTop >= frame.scrollHeight - frame.clientHeight) {
            toggleAutoScroll();
            return; //do not scroll to top
        }
        lastTimestamp = timestamp;
        scrollAnimationFrame = requestAnimationFrame(smoothScroll);
    }

    function updatecountUpTimer(timestamp) {
        if (!startTime) startTime = timestamp;
        const seconds = Math.floor((timestamp - startTime) / 1000);
        const minutes = Math.floor(seconds / 60);
        const displaySeconds = String(seconds % 60).padStart(2, '0');
        const displayMinutes = String(minutes).padStart(2, '0');
        document.getElementById('countUpTimer').textContent = `${displayMinutes}:${displaySeconds}`;
    }

    function countdown() {
        return new Promise((resolve) => {
            let count = 5;
            const countdownFrame = document.getElementById('countdownFrame');
            const countdown = document.getElementById('countdown');
            countdown.textContent = "Ready";
            countdownFrame.style.display = 'flex';
            
            const countInterval = setInterval(() => {
                if (count > 0) {
                    countdown.textContent = count;
                    count--;
                } else {
                    clearInterval(countInterval);
                    countdownFrame.style.display = 'none';
                    countdown.textContent = '';
                    // startTime = 0;
                    // scrollAnimationFrame = requestAnimationFrame(smoothScroll);
                    resolve();
                }
            }, 1000);
        });
    }

    async function toggleAutoScroll() {
        const btn = document.getElementById('autoScrollBtn');
        const countUpTimer = document.getElementById('countUpTimer');
        const topLINE = document.getElementById('topLINE');
        // const midLINE = document.getElementById('midLINE');
        const btmLINE = document.getElementById('btmLINE');
        
        if (scrollAnimationFrame) {
            cancelAnimationFrame(scrollAnimationFrame);
            scrollAnimationFrame = null;
            lastTimestamp = null;
            startTime = null;
            btn.textContent = 'Auto Scroll';
            // countUpTimer.style.display = 'none';
            topLINE.style.display = 'none';
            // midLINE.style.display = 'none';
            btmLINE.style.display = 'none';
        } else {
            btn.textContent = 'Stop Scrolling';
            // timer.style.display = 'block';
            await countdown();
            topLINE.style.display = 'block';
            // midLINE.style.display = 'block';
            btmLINE.style.display = 'block';
            startTime = null;
            scrollAnimationFrame = requestAnimationFrame(smoothScroll);
        }
    }

    // Update speed event listener
    document.getElementById('scrollSpeed').addEventListener('change', () => {
        if (scrollAnimationFrame) {
            lastTimestamp = null;  // Reset timestamp for new speed calculation
        }
        saveScrollSpeed();
    });

    // Initialize 
    generateMockData();
    renderTokens();

    // Add all event listeners
    ['fontSizeCOMBO', 'lineHeightCOMBO', 'colorCOMBO'].forEach(id => {
        document.getElementById(id).addEventListener('click', function(){updateSelectedRows(id)});
    });

    document.getElementById('autoScrollBtn').addEventListener('click', toggleAutoScroll);

    function generateMockData() {
        const colors = ['aqua', 'purple', 'dodgerblue', 'turquoise', 'cyan'];
        for(let i = TOKEN_DATASET.length+1; i <= 14; i++) {
            TOKEN_DATASET.push({
                row: i,
                txt: [`test text ${i}`],
                color: colors[Math.floor(Math.random() * colors.length)],
                size: Math.floor(Math.random() * 3) + 1,
                height: Math.floor(Math.random() * 3) + 1
            });
        }
    }

    function formatTokenText(text) {
        let formattedText = text;
        formattedText = formattedText.replace(/</g, '&lt;').replace(/>/g, '&gt;');
        formattedText = formattedText.replace(/&lt;(.*?)&gt;/g, '<span style="color: cyan">&lt;$1&gt;</span>');
        formattedText = formattedText.replace(/\[(.*?)\]/g, '<span style="color: lime; font-style: italic">[$1]</span>')
            .replace(/\((.*?)\)/g, '<span style="color: red; font-weight: bold">($1)</span>');
        formattedText = formattedText.replace(/^#(.*)$/gm, '<strong>$1</strong>');
        formattedText = formattedText.replace(/(\w*_\w*)/g, '<span style="color: green">$1</span>');
        formattedText = formattedText.replace(/\b(a[a-z]*[A-Z][a-zA-Z]*)\b/g, '<span style="color: lime">$1</span>');
        let finalVal = formattedText.trim();
        return finalVal;

    }

    function renderTokens() {
        // Save checkbox states
        const checkboxes = document.querySelectorAll('.spot_checkmark');
        checkboxStates = Array.from(checkboxes).map(cb => ({
            index: cb.dataset.row,
            checked: cb.checked
        })); //END SAVE CHECKBOX STATES

        const frame = document.getElementById('renderTokenFrame');
        frame.innerHTML = '';

        TOKEN_DATASET.forEach(token => {
            const rowElement = document.createElement('div');
            rowElement.className = 'token-row';

            // Format token text with regex matches
            const formattedText = token.txt.map(text => formatTokenText(text)).join(' ');

            rowElement.innerHTML = `
                <span style="margin-top: 0.444em;font-size:0.666em;">${token.row}</span>
                <label class="checkboxFrame">
                    <input type="checkbox" class="spot_checkmark" data-row="${token.row}">
                    <span class="checkmark"></span>
                </label>
                <div class="token-text" 
                     data-row="${token.row}" 
                     onclick="makeEditable(this, event)"
                     style="color: ${token.color};
                            font-size: ${token.size}em;
                            line-height: ${token.height};">
                    ${formattedText}
                </div>`;

            frame.appendChild(rowElement);
        });
        // Restore checkbox states
        checkboxStates.forEach(state => {
            const checkbox = document.querySelector(`.spot_checkmark[data-row="${state.index}"]`);
            if (checkbox) {
                checkbox.checked = state.checked;
            }
        }); //end RESTORE CHECKBOX STATES

        // Restore select all state
        const selectAllCheckbox = document.getElementById('selectAll');
        if (selectAllCheckbox) {
            selectAllCheckbox.checked = isSelectAllChecked;
            if(isSelectAllChecked){
                const tokenCheckboxes = document.querySelectorAll('.spot_checkmark');
                tokenCheckboxes.forEach(cb => {
                    cb.checked = isSelectAllChecked;
                });
            }
        }
    }

    let currentEditableRow = null;

    function makeEditable(element, event) {
        if (event) {
            event.stopPropagation();
        }
        
        // Don't make editable if clicking inside input
        if (event && event.target.classList.contains('edit-input')) {
            return;
        }

        const row = element.dataset.row;
        
        // Save current editable row if exists
        if (currentEditableRow && currentEditableRow !== row) {
            const currentInput = document.querySelector(`[data-row="${currentEditableRow}"] .edit-input`);
            if (currentInput) {
                saveInline_EDIT(currentEditableRow);
            }
        }

        currentEditableRow = row;
        const originalText = element.innerText;
        
        element.innerHTML = `
            <input type="text" 
                value="${originalText}" 
                class="edit-input" 
                onclick="event.stopPropagation()"
                style="width: 80%;
                       color: inherit;
                       font-size: inherit;
                       line-height: inherit;">
            <button onclick="saveInline_EDIT(${row})" class="save-btn">Save</button>
            <button onclick="cancelEdit(${row}, '${originalText}')" class="cancel-btn">Cancel</button>
        `;
        element.querySelector('.edit-input').focus();
    }

    function cancelEdit(row, originalText) {
        currentEditableRow = null;
        const element = document.querySelector(`[data-row="${row}"]`);
        if (element) {
            const token = TOKEN_DATASET.find(t => t.row === parseInt(row));
            token.txt = [originalText];
            renderTokens();
        }
    }

    function saveInline_EDIT(row) {
        currentEditableRow = null;
        const input = document.querySelector(`[data-row="${row}"] .edit-input`);
        const token = TOKEN_DATASET.find(t => t.row === parseInt(row));
        if (token && input) {
            token.txt = [input.value];
            renderTokens();
            saveTokenTXT(TXT_IDX, row, input.value);
        }
    }

    function updateSelectedRows(id) {
        const selectedValue = document.getElementById(id).value;
        const checkboxes = document.querySelectorAll('.spot_checkmark:checked');
        
        checkboxes.forEach(checkbox => {
            const rowIndex = parseInt(checkbox.dataset.row) - 1;
            const token = TOKEN_DATASET[rowIndex];
            
            switch(id) {
                case 'colorCOMBO':
                    token.color = selectedValue;
                    break;
                case 'fontSizeCOMBO':
                    token.size = parseInt(selectedValue);
                    break;
                case 'lineHeightCOMBO':
                    token.height = parseInt(selectedValue);
                    break;
            }
            
            saveTokenProperties(TXT_IDX, rowIndex, {
                color: token.color,
                size: token.size,
                height: token.height
            });
        });
        
        renderTokens();
    }

    function toggleAll(checkbox) {
        isSelectAllChecked = checkbox.checked;
        const tokenCheckboxes = document.querySelectorAll('.spot_checkmark');
        tokenCheckboxes.forEach(cb => {
            cb.checked = isSelectAllChecked;
        });
    }

    function PLAY_prevTXT() {
        if (TXT_IDX > 0) {
            TXT_IDX--;
        } else {
            TXT_IDX = ai_aSCRIBEa_DATA["TXTZ"].length - 1;
        }
        renderPLAYBACK_VIEW();
        toggleFrameSize(2);
    }

    function PLAY_nextTXT() {
        if (TXT_IDX < ai_aSCRIBEa_DATA["TXTZ"].length - 1) {
            TXT_IDX++;
        } else {
            TXT_IDX = 0;
        }
        renderPLAYBACK_VIEW();
        toggleFrameSize(2);
    }

    function renderPLAYBACK_VIEW() {
        renderTokensFromTXT();
        setScrollSpeed();
    }

    function saveScrollSpeed(){
        const speed = document.getElementById('scrollSpeed').value || "100"; //default "normal"
        if(ai_aSCRIBEa_DATA["TXTZ"][TXT_IDX]){
            ai_aSCRIBEa_DATA["TXTZ"][TXT_IDX].speed = speed;
            SAVE_DOCZ();
        }
    }

    function setScrollSpeed(){
        if(ai_aSCRIBEa_DATA["TXTZ"][TXT_IDX].speed){
            const speed = ai_aSCRIBEa_DATA["TXTZ"][TXT_IDX].speed||"100";//default "normal"
            document.getElementById('scrollSpeed').value = speed;
        }else{ console.log('⚠️ NO SPEED ⚠️'); }
    }

    function getTXT_DOC(main_title){
        if(main_title){
            const existingIndex = ai_aSCRIBEa_DATA["TXTZ"].findIndex(doc => doc.main_title === main_title);
            if (existingIndex > -1) {
                return ai_aSCRIBEa_DATA["TXTZ"][existingIndex];
            } else { showUSRMSG('⚠️ TXT NOT FOUND ⚠️');  }
        }
        return null;
    }

    function renderTokensFromTXT() {
        const doc = ai_aSCRIBEa_DATA["TXTZ"][TXT_IDX];
        let doc_id = "";
        if(doc.id){  doc_id = doc.id;
        } else { //set doc.id //todo move to saveTXT_EDIT or init
            doc_id = doc.main_title.trim()+' | '+doc.sub_title.trim()+' | '+doc.version.trim()+' | '+current_ymd ;
        }
        document.getElementById('PLAYBACK_TXT_TITLE').value = doc_id; 
        // document.getElementById('PLAYBACK_TXT_TITLE').value = doc.main_title;
        let TOKEN_TXT = doc.txt.split('\n');

        TOKEN_TXT = TOKEN_TXT.filter(token => token.trim() !== '');
        TOKEN_DATASET = TOKEN_TXT.map((line, index) => {
            const props = getTokenProperties(TXT_IDX, index);
            return {
                row: index + 1,
                txt: [line],
                ...props
            };
        });
        renderTokens();
    }

    let isMaximized = false;
    let sizeState = 0; // 0=min, 1=300px, 2=max

    function toggleFrameSize(init) {
        const frame = document.getElementById('renderTokenFrame');
        const controls = document.querySelector('.control-row');
        const hint = document.querySelector('.keyboard-hint');
        const btn = document.getElementById('toggleSize');
        const checkboxes = document.querySelectorAll('.checkboxFrame');
        
        sizeState = (sizeState + 1) % 3;
        sizeState = init ? init : sizeState;
        
        switch(sizeState) {
            case 0: // min
                frame.classList.remove('maximized', 'middle-size');
                controls.classList.remove('hidden');
                hint.classList.remove('hidden');
                checkboxes.forEach(cb => cb.classList.remove('hidden'));
                btn.innerHTML = '<span>▲</span>';
                break;
            case 1: // 300px
                frame.classList.remove('maximized');
                frame.classList.add('middle-size');
                controls.classList.add('hidden');
                hint.classList.add('hidden');
                checkboxes.forEach(cb => cb.classList.add('hidden'));
                btn.innerHTML = '<span>△</span>';
                break;
            case 2: // max
                frame.classList.add('maximized');
                frame.classList.remove('middle-size');
                controls.classList.add('hidden');
                hint.classList.add('hidden');
                checkboxes.forEach(cb => cb.classList.add('hidden'));
                btn.innerHTML = '<span>▼</span>';
                break;
        }
    } //toggleFrameSize(2);

    // Initialize metadata structure if not exists
    if (!ai_aSCRIBEa_DATA["METADATA"]) {
        ai_aSCRIBEa_DATA["METADATA"] = {};
    }

    function saveTokenTXT(txtIndex, rowIndex, txt) {
        if (!ai_aSCRIBEa_DATA["TXTZ"][txtIndex]||!rowIndex||!txt) { return }
        // LOOKUP TXTZ line of text.
        let TOKEN_TXT = ai_aSCRIBEa_DATA["TXTZ"][txtIndex].txt.split('\n');
        TOKEN_TXT = TOKEN_TXT.filter(token => token.trim() !== '');
        TOKEN_TXT[rowIndex-1] = txt; //SET TXT EDIT DATA.
        const docSTR = TOKEN_TXT.join('\n');

        ai_aSCRIBEa_DATA["TXTZ"][txtIndex].txt = docSTR;
        SAVE_DOCZ();
    }

    function saveTokenProperties(txtIndex, rowIndex, properties) {
        if (!ai_aSCRIBEa_DATA["METADATA"][txtIndex]) {
            ai_aSCRIBEa_DATA["METADATA"][txtIndex] = {};
        }
        ai_aSCRIBEa_DATA["METADATA"][txtIndex][rowIndex] = properties;
        SAVE_DOCZ();
    }

    function getTokenProperties(txtIndex, rowIndex) {
        return ai_aSCRIBEa_DATA["METADATA"]?.[txtIndex]?.[rowIndex] || {
            color: 'steelblue',
            size: 1,
            height: 1
        };
    }
</script>

<div id="topLINE" class="topLINE"></div>
<!-- <div id="midLINE" class="midLINE"></div> -->
<div id="btmLINE" class="btmLINE"></div>

<footer id="NAV_MENU" class="pcStyle" style="display:flex;justify-content:space-evenly;margin:0 auto; 
background-image: linear-gradient(grey, #052f52, black);height: 2em;
align-items: center; padding:0.222em;
box-shadow: 0 0 4px 2px steelblue;border-radius:13px;">
      <button class="mainBtn" onclick="showINFO()" 
       style="height:2em;padding: 3px;">
         <span style="border-radius:100%;background:blue;
           border:1px solid grey;margin-right:3px;">
         💠</span><span class="btnTXT hoverTXT">INFO</span>
      </button>
       <!-- <button class="mainBtn" onclick="showCREATE()" 
        style="height:2em;padding: 3px;">
          <span style="border-radius:100%;background:lime;border:1px solid grey;">
            🎇</span> <span class="btnTXT hoverTXT">CREATE</span>
       </button> -->
       <button class="mainBtn" onclick="showEDIT()" 
        style="height:2em;padding: 3px;">
          <span style="border-radius:100%;background:aqua;border:1px solid grey;">
            💫</span> <span class="btnTXT hoverTXT">EDIT</span>
       </button>
       <button class="mainBtn" onclick="showPLAYBACK()" 
        style="height:2em;padding: 3px;">
          <span style="border-radius:100%;background:purple;border:1px solid grey;">
            🎭</span> <span class="btnTXT hoverTXT">PLAYBACK</span>
       </button> 
      </footer> 
      <legal style="color:darkslategray;font-size: 0.666em;
      display:flex;flex: 0 0 auto; margin-top: 1em;">copyright 2020-
      <span id="dateTXTStamp">2025</span>
      <script>
        const dateTXTStamp = document.getElementById('dateTXTStamp');
        dateTXTStamp.innerHTML = new Date().getFullYear();</script>
      
      &nbsp; netcinematics.llc, all rights reserved.</legal>
<script>
const NAV_PLAYBACK = document.getElementById('NAV_PLAYBACK');
// NAV_PLAYBACK.style.display = 'block';//DEFAULT_VIEW
const NAV_EDIT = document.getElementById('NAV_EDIT');
NAV_EDIT.style.display = 'flex';//DEFAULT_VIEW
// const NAV_CREATE = document.getElementById('NAV_CREATE');
const NAV_INFO = document.getElementById('NAV_INFO');
function showINFO() {
    NAV_INFO.style.display = 'block';
    // NAV_CREATE.style.display = 'none';
    NAV_EDIT.style.display = 'none';
    NAV_PLAYBACK.style.display = 'none';
}

// function showCREATE() {
//     NAV_INFO.style.display = 'none';
//     NAV_CREATE.style.display = 'block';
//     NAV_EDIT.style.display = 'none';
//     NAV_PLAYBACK.style.display = 'none';
// }

function showEDIT() {
    NAV_INFO.style.display = 'none';
    // NAV_CREATE.style.display = 'none';
    NAV_EDIT.style.display = 'flex';
    NAV_PLAYBACK.style.display = 'none';
    init_EDIT_VIEW();
}

function showPLAYBACK() {
    NAV_INFO.style.display = 'none';
    // NAV_CREATE.style.display = 'none';
    NAV_EDIT.style.display = 'none';
    NAV_PLAYBACK.style.display = 'block';
    renderPLAYBACK_VIEW();
    toggleFrameSize(2);
}
</script>
<script>
    //add code to load data from .md file
    async function loadMarkdown() {
        try {
            const response = await fetch('./SONGS/Secret_to_Life.md');
            if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`);}
            const markdownText = await response.text();
            // Set the markdown content to the text area
            // document.getElementById('EDIT_TXT_TXT').value = markdownText;
        } catch (error) {
            console.error('Could not load markdown file:', error);
            showUSRMSG('Failed to load markdown file');
        }
    }; window.onload = loadMarkdown;
    // Call the function to load the markdown file when the page loads

    //add code to save data to .md file
    async function saveMarkdown() {
        const markdownText = document.getElementById('EDIT_TXT_TXT').value;
        // const filename = document.getElementById('EDIT_TXT_TITLE_MAIN').value + '.md';
        const filename = `${ai_aSCRIBEa_DATA['TXTZ'][TXT_IDX].id}.md`;
        // Create a blob from the markdown text
        const blob = new Blob([markdownText], { type: 'text/markdown' });
        // Create a download link
        const downloadLink = document.createElement('a');
        downloadLink.href = URL.createObjectURL(blob);
        downloadLink.download = filename;
        // Programmatically click the link to trigger the download
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);
        // showUSRMSG('Markdown file saved!');
    }
</script>
</body>
</html>